- provide :title, "Snapshot | #{@snapshot.url_id}"

:ruby
  crumbs = [[@snapshot.url.project.name, project_path(@snapshot.url.project)]]
  if @snapshot.sweep
    crumbs << ['Sweeps', project_sweeps_path(@snapshot.url.project)]
    crumbs << [@snapshot.sweep.title, [@snapshot.url.project, @snapshot.sweep]]
    crumbs << [simplified_url(@snapshot.url.address)]
  else
    crumbs << [simplified_url(@snapshot.url.title), url_path(@snapshot.url)]
  end
  crumbs << [@snapshot.viewport]

= render 'shared/breadcrumbs', crumbs: crumbs

= render 'snapshots/review_list' if @review_list

.snapshot
  = render 'snapshots/header_and_buttons'

  - if @snapshot.diff?
    .snapshot-diff-image.snapshot-image
      %h2
        Diff
        %small= number_to_percentage(@snapshot.snapshot_diff.diff_in_percent)
      - if @snapshot.snapshot_diff.diff_in_percent > 0
        - if @snapshot.snapshot_diff.sprite?
          - # Only show tabs for snapshot diffs that are sprites
          %ul.nav.nav-tabs
            %li.active= link_to 'Diff', '#', data: { diff_offset: '-100%' }
            %li= link_to 'Before',      '#', data: { diff_offset: '0' }
            %li= link_to 'After',       '#', data: { diff_offset: '-200%' }
        .snapshot-diff-with-clusters
          :ruby
            image_height = @snapshot.snapshot_diff.image_height
            max_width = if (width = @snapshot.snapshot_diff.image_width)
                          width / 3
                        else
                          1200
                        end
          - @snapshot.snapshot_diff.snapshot_diff_clusters.each do |cluster|
            .snapshot-diff-cluster{ style: "top: #{cluster.relative_start(image_height)}%; height: #{cluster.relative_height(image_height)}%; max-width: #{max_width}px",
                                    data: { keyboard_focusable: true } }
              %i.glyphicon.glyphicon-chevron-right.text-primary
          - if @snapshot.snapshot_diff.sprite?
            - # If the snapshot diff is a sprite, we show only a third at a time.
            .snapshot-diff-sprite{ style: "max-width: #{max_width}px;" }
              = image_tag @snapshot.snapshot_diff.image.url
          - else
            - # Fallback for old snapshot diffs that are not sprites
            = image_tag @snapshot.snapshot_diff.image.url


  .clearfix
    - if @snapshot.diff? && @snapshot.snapshot_diff.diff_in_percent > 0
      .pull-left.snapshot-image
        %h2= link_to 'Compared against', @snapshot.snapshot_diff.before_snapshot
        = link_to image_tag(@snapshot.snapshot_diff.before_snapshot.image.url),
          @snapshot.snapshot_diff.before_snapshot

    - if @snapshot.image?
      .pull-left.snapshot-image
        %h2 Snapshot image
        = image_tag(@snapshot.image.url)
